<#macro comboOrders name default_value max >
<select id="${name}" name="${name}" class="input-mini" >
    <#list 1..max as i>
    <#if "${default_value}" == "${i}">
    <option selected="selected" value="${i}" >${i}</option>
    <#else>
    <option value="${i}" >${i}</option>
    </#if>
    </#list>
</select>
</#macro>

<div class="row-fluid">
    <div class="span4">
        <fieldset>
		<legend> #i18n{workflow.modify_workflow.title}</legend>
			<form class="form" action="jsp/admin/plugins/workflow/DoModifyWorkflow.jsp" method="post" name="" id=""  >
                <input name="id_workflow" value="${workflow.id}" type="hidden">

                <div class="control-group">
                    <label class="control-label" for="name">#i18n{workflow.create_workflow.label_name} * : </label>
                    <div class="controls">
                        <input type="text" name="name" id="" size="80" value="${workflow.name}"  maxlength="255"/>
                        <span class="help-block">#i18n{workflow.create_workflow.label_name_comment}</span>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="description"> #i18n{workflow.create_workflow.label_description} * : </label>
                    <div class="controls">
                        <textarea name="description" cols="80" rows="2">${workflow.description}</textarea>
                        <span class="help-block">#i18n{workflow.create_workflow.label_description_comment}</span>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="">#i18n{workflow.create_workflow.label_workgroup}  : </label>
                    <div class="controls">
                        <@combo name="workgroup"  items=user_workgroup_list default_value=workflow.workgroup />
                        <span class="help-block">#i18n{workflow.create_workflow.label_workgroup_comment}</span>
                    </div>
                </div>
                <div class="form-actions" >
                    <button class="btn btn-primary btn-small" type="submit" name="save" >
						<i class="icon-ok icon-white"></i> #i18n{workflow.create_workflow.button_save}
					</button>
                    <button class="btn btn-primary btn-small" type="submit" name="apply" >
						<i class="icon-ok-circle icon-white"> </i> #i18n{workflow.modify_workflow.button_apply}
					</button>
                    <button class="btn btn-small" type="submit" name="cancel" >
						<i class="icon-remove-circle"> </i> #i18n{workflow.create_workflow.button_cancel}
					</button>
                </div>
            </fieldset>
        </form>
    </div>
    <div class="span8">
        <ul id="tabs" class="nav nav-tabs">
            <li <#if pane="pane-states">class="active"</#if> >
                <a href="#pane-states" data-toggle="tab">#i18n{workflow.modify_workflow.manage_state.title}</a>
			</li>
            <li <#if pane="pane-actions">class="active"</#if> >
				<a href="#pane-actions" data-toggle="tab">#i18n{workflow.modify_workflow.manage_action.title}</a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane <#if pane="pane-states">active</#if>" id="pane-states">
                <div class="pull-right">
                    <form class="form-inline pull-right"  method="post"  action="jsp/admin/plugins/workflow/CreateState.jsp?id_workflow=${workflow.id}#list_state">
                        <button class="btn btn-primary btn-small" type="submit" >
                            <i class="icon-plus icon-white"> </i> 
                            #i18n{workflow.modify_workflow.manage_state.button_insert_state}
                        </button>
                    </form>
                	<a class="btn btn-primary btn-small pull-right spaced" href="jsp/admin/plugins/workflow/DoUpdateStateOrder.jsp?id_workflow=${workflow.id}" title="#i18n{workflow.modify_workflow.init_order}">
						<i class="icon-refresh icon-white"></i>	
					</a>
                </div>
			    <@paginationAdmin paginator=paginator_state combo=1 nb_items_per_page=nb_items_per_page_state/>
                <table class="table table-striped table-condensed">
                    <tr>
                        <th>#i18n{workflow.modify_workflow.manage_state.row_name}</th>
                        <th>#i18n{workflow.modify_workflow.order}</th>
                        <th>#i18n{workflow.modify_workflow.manage_state.row_actions}</th>
                    </tr>
                    <#list state_list as state>
                    <tr>
                        <td>${state.name}</td>
                        <td>
                            <!-- SELECT LIST FOR ORDER CHANGE -->
                            <form class="form-inline" method="post" action="jsp/admin/plugins/workflow/DoChangeOrderState.jsp">
                                <@comboOrders name="order_id" default_value=state.order max=number_state />
                                <input type="hidden" name="id_workflow" value="${workflow.id}" />
                                <input type="hidden" name="id_state" value="${state.id}" />
                                <button class="btn btn-primary btn-small" type="submit" title="#i18n{workflow.modify_workflow.move}">
									<i class="icon-resize-vertical icon-white">
								</button>
                            </form>
                        </td>
                        <td>
                            <a class="btn btn-primary btn-small" href="jsp/admin/plugins/workflow/ModifyState.jsp?id_state=${state.id}"  title="#i18n{workflow.modify_workflow.manage_state.title_modify}" >
                                <i class="icon-edit icon-white"></i>
                            </a>
                            <a class="btn btn-primary btn-small" href="jsp/admin/plugins/workflow/DoCopyState.jsp?id_state=${state.id}"  title="#i18n{workflow.modify_workflow.manage_state.title_copy_state}" >
                                <i class="icon-plus-sign icon-white"></i>
                            </a>
                            <a class="btn btn-danger btn-small" href="jsp/admin/plugins/workflow/ConfirmRemoveState.jsp?id_state=${state.id}"  title="#i18n{workflow.modify_workflow.manage_state.title_delete}" >
                                <i class="icon-trash icon-white"></i>
                            </a>
                        </td>
                    </tr>
                    </#list>
                </table>
                <@paginationAdmin paginator=paginator_state nb_items_per_page=nb_items_per_page_state/>
            </div>
            <div class="tab-pane <#if pane="pane-actions">active</#if>" id="pane-actions">
                <div class="pull-right">
                    <form class="form-inline pull-right"  method="post" action="jsp/admin/plugins/workflow/CreateAction.jsp?id_workflow=${workflow.id}#list_action">
                        <button class="btn btn-primary btn-small" type="submit" >
                            <i class="icon-plus icon-white"> </i> 
                            #i18n{workflow.modify_workflow.manage_action.button_insert_action}
                        </button>
                    </form>
					<a class="btn btn-primary btn-small pull-right spaced" href="jsp/admin/plugins/workflow/DoUpdateActionOrder.jsp?id_workflow=${workflow.id}#list_action" title="#i18n{workflow.modify_workflow.init_order}" >
						<i class="icon-refresh icon-white"></i>	
					</a>
                </div>
                <@paginationAdmin paginator=paginator_action combo=1 nb_items_per_page=nb_items_per_page_action/>
                <table class="table table-striped table-condensed">
                    <tr>
                        <th>#i18n{workflow.modify_workflow.manage_action.row_name}</th>
                        <th>#i18n{workflow.modify_workflow.order}</th>
						<th>#i18n{workflow.modify_workflow.manage_action.row_actions}</th>
                    </tr>
                    <#list action_list as action>
                    <tr>
                        <td class="span8">
							<strong>${action.name}</strong>
							<p>
								<small title="#i18n{workflow.modify_workflow.manage_action.row_state_before}">${action.stateBefore.name}</small>
								<i class="icon-arrow-right"></i>
								<small title="#i18n{workflow.modify_workflow.manage_action.row_state_after}"> ${action.stateAfter.name}</small>
							</p>
						</td>
                        <td>
                            <!-- SELECT LIST FOR ORDER CHANGE -->
                            <form class="form-inline" method="post" action="jsp/admin/plugins/workflow/DoChangeOrderAction.jsp">
                                <@comboOrders name="order_action_id" default_value=action.order max=number_action />
                                <input type="hidden" name="id_workflow" value="${workflow.id}" />
                                <input type="hidden" name="id_action" value="${action.id}" />
                                <button class="btn btn-primary btn-small" type="submit" title="#i18n{workflow.modify_workflow.move}">
									<i class="icon-resize-vertical icon-white"></i>
								</button>
                            </form>
                       </td>
                        <td>
                            <a class="btn btn-primary btn-small" href="jsp/admin/plugins/workflow/ModifyAction.jsp?id_action=${action.id}"  title="#i18n{workflow.modify_workflow.manage_action.title_modify}" >
                                <i class="icon-edit icon-white"></i>
                            </a>
                            <a class="btn btn-primary btn-small" href="jsp/admin/plugins/workflow/DoCopyAction.jsp?id_action=${action.id}"  title="#i18n{workflow.modify_workflow.manage_state.title_copy_action}" >
                                <i class="icon-plus-sign icon-white"></i>
                            </a>
                            <a class="btn btn-danger btn-small" href="jsp/admin/plugins/workflow/ConfirmRemoveAction.jsp?id_action=${action.id}"  title="#i18n{workflow.modify_workflow.manage_action.title_delete}" >
                                <i class="icon-trash icon-white"></i>
                            </a>
                        </td>
                    </tr>
                    </#list>
                </table>
                <@paginationAdmin paginator=paginator_action nb_items_per_page=nb_items_per_page_action/>
            </div>
        </div>
    </div>
</div>
