<#include "macro_workflows.html" />
<div class="row-fluid">
    <div class="span12">
        <form class="form-horizontal" action="jsp/admin/plugins/workflow/DoModifyAction.jsp?plugin_name=workflow" method="post" name="" id=""  >
            <fieldset>
                <legend> #i18n{workflow.modify_action.title}</legend>
                <input name="id_action" value="${action.id}" type="hidden">
                <div class="control-group">
                    <label class="control-label" for="name">#i18n{workflow.create_action.label_name} * : </label>
                    <div class="controls">
                        <input type="text" name="name" id="" size="80" value="${action.name}"  maxlength="255"/>
                        <span class="help-block">#i18n{workflow.create_action.label_name_comment}</span>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for="description"> #i18n{workflow.create_action.label_description} * : </label>
                    <div class="controls">
                        <textarea name="description" cols="80" rows="2">${action.description}</textarea>
                        <span class="help-block">#i18n{workflow.create_action.label_description_comment}</span>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for="id_state_before"> #i18n{workflow.create_action.label_state_before} * : </label>
                    <div class="controls">
                        <@combo name="id_state_before"  items=state_list default_value=action.stateBefore.id />
                        <span class="help-block">#i18n{workflow.create_action.label_state_before_comment}</span>
                    </div>
                </div>	

                <div class="control-group">
                    <label class="control-label" for="id_state_after"> #i18n{workflow.create_action.label_state_after} * : </label>
                    <div class="controls">
                        <@combo name="id_state_after"  items=state_list default_value=action.stateAfter.id />
                        <span class="help-block">#i18n{workflow.create_action.label_state_after_comment}</span>
                    </div>
                </div>	

                <div class="control-group">
                    <label class="control-label" for="id_icon"> #i18n{workflow.create_action.label_icon} * : </label>
                    <div class="controls">
                        <@radioIconList name="id_icon" default_value=action.icon.id icons=icon_list />	
                        <span class="help-block">#i18n{workflow.create_action.label_icon_comment}</span>
                    </div>
                </div>


                <div class="control-group">
                    <label class="control-label" for="automatic">#i18n{workflow.create_action.label_automatic} : </label>
                    <div class="controls">
                        <#if action.automaticState>
                        <input type="checkbox" name="automatic" value="1" checked="checked" />
                        <#else>	
                        <input type="checkbox" name="automatic" value="1"/>
                        </#if>
                        <span class="help-block">#i18n{workflow.create_action.label_automatic_comment}</span>
                    </div>
                </div>


                <div class="control-group">
                    <label class="control-label" for="is_mass_action">#i18n{workflow.create_action.label_mass_action} : </label>
                    <div class="controls">
                        <#if action.massAction>
                        <input type="checkbox" name="is_mass_action" value="1" checked="checked" />
                        <#else>	
                        <input type="checkbox" name="is_mass_action" value="1"/>
                        </#if>
                        <span class="help-block">#i18n{workflow.create_action.label_mass_action_comment}</span>
                    </div>
                </div>


                <div class="control-group">
                    <label class="control-label" for="">#i18n{workflow.create_action.label_link_actions} :</label>
                    #i18n{workflow.create_action.label_link_actions_comment}
                    <span class="help-block">#i18n{workflow.create_action.label_link_actions_example}</span>

                    <#if !display_tasks_form>
                    <table class="table table-striped table-condensed">
                        <tr>
                            <th>#i18n{workflow.create_action.label_available_linked_actions}</th>
                            <th>&nbsp;</th>
                            <th>#i18n{workflow.create_action.label_selected_linked_actions}</th>
                        </tr>
                        <tr>
                            <td>
                                <@comboWithParamsAndLength name="select_linked_actions" default_value="" additionalParameters="multiple='multiple' size='10' style='width:100%;'" items=available_linked_actions max_length=175 />
                            </td>
                            <td>
                                <div align="center">
                                    <button class="btn btn-primary btn-small" type="submit" >#i18n{workflow.create_action.label_select_unselect_linked_actions}</button>
                                </div>
                            </td>
                            <td>
                                <@comboWithParamsAndLength name="unselect_linked_actions" default_value="" additionalParameters="multiple='multiple' size='10' style='width:100%;'" items=selected_linked_actions max_length=175 />
                            </td>
                        </tr>
                    </table>
                    <#else>

                    <div class="control-group">
                        <label class="control-label" for="">&nbsp;</label>
                        <span class="alert">#i18n{workflow.create_action.label_link_actions_comment_display_task_forms}</span>

                        </#if>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-primary btn-small" type="submit" >#i18n{workflow.create_action.button_save}</button>
                        <button class="btn btn-primary btn-small" type="submit" >#i18n{workflow.modify_action.button_apply}</button><!--todo-->
                        <button class="btn btn-small" onclick="javascript:history.go(-1)" >#i18n{workflow.create_action.button_cancel}</button>
                    </div>

            </fieldset>
        </form>
    </div>
</div>

<div class="row-fluid">
    <div class="span12">
        <form class="form-horizontal" action="jsp/admin/plugins/workflow/DoInsertTask.jsp?plugin_name=workflow" method="post" name="" id=""  >
            <fieldset>
                <legend> #i18n{workflow.modify_action.manage_task.title}</legend>
                <input name="id_action" value="${action.id}" type="hidden">

                <div class="control-group">
                    <label class="control-label" for="task_type_key"> #i18n{workflow.modify_action.manage_task.insert_new_task}  : </label>
                    <div class="controls">
                        <@combo name="task_type_key"  items=task_type_list default_value=-1 />
                    </div>
                </div>

                <button class="btn btn-primary btn-small" type="submit" >#i18n{workflow.create_action.button_insert_new_task}</button>

                <br/>
                <div class="control-group">
                    <label class="control-label" > &nbsp;</label>
                    #i18n{workflow.modify_action.manage_task.warning_assignment}


                    <a href="jsp/admin/plugins/workflow/UpdateTaskOrder.jsp?id_action=${action.id}">
                        <img src="images/admin/skin/plugins/workflow/actions/initOrder.png"
                             alt="#i18n{workflow.modify_workflow.init_order}"
                             title="#i18n{workflow.modify_workflow.init_order}" />
                    </a>

            </fieldset>
        </form>

        <table class="table table-striped table-condensed">
            <tr>
                <th> #i18n{workflow.modify_action.manage_task.row_number} </th>
                <th> #i18n{workflow.modify_action.manage_task.row_title} </th>
                <th> #i18n{workflow.modify_action.manage_task.row_task_type} </th>
                <th> #i18n{workflow.modify_workflow.order} </th>
                <th> #i18n{workflow.modify_action.manage_task.row_actions} </th>
            </tr>
            <#assign cpt=0>	
            <#list task_list as task>

            <#assign cpt=cpt+1>
            <tr>
                <td> ${cpt} </td>
                <td> ${task.getTitle(locale)} </td>
                <td> ${task.taskType.title} </td>
                <td>
                    <!-- SELECT LIST FOR ORDER CHANGE -->
                    <form class="form-horizontal" method="post" action="jsp/admin/plugins/workflow/DoChangeOrderTask.jsp">
                        <fieldset>
                            <@comboOrders name="order_task_id" default_value=task.order max=number_task />
                            <input type="hidden" name="id_workflow" value="${action.workflow.id}" />
                            <input type="hidden" name="id_task" value="${task.id}" />
                            <button class="btn btn-primary btn-small" type="submit" >#i18n{workflow.modify_workflow.move}</button>

                        </fieldset>
                    </form>
                </td>
                <td>
                    <#if task.taskType.configRequired>
                    <a class="btn btn-primary btn-small" href="jsp/admin/plugins/workflow/ModifyTask.jsp?id_task=${task.id}"  title="#i18n{workflow.manage_workflow.title_modify}" >
                        <i class="icon-edit icon-white"></i>
                    </a>
                    </#if>
                    <a class="btn btn-primary btn-small" href="jsp/admin/plugins/workflow/DoCopyTask.jsp?id_task=${task.id!}"  title="#i18n{workflow.modify_action.manage_task.title_copy}" >
                        <i class="icon-plus-sign icon-white"></i>
                    </a>

                    <a class="btn btn-danger btn-small" href="jsp/admin/plugins/workflow/ConfirmRemoveTask.jsp?id_task=${task.id}"  title="#i18n{workflow.modify_action.manage_task.title_delete}" >
                        <i class="icon-trash icon-white"></i>
                    </a>

                </td>
            </tr>
            </#list>
        </table>
    </div>   
</div>


